business:
- business:
  desc: 文档下载
  params:
    文档名称:
      value: 文档重命名
      path: $[5].params.params._20_keywords
step:
- action: HttpAction
  method: request
  desc: 发送POST请求,查询文件夹
  params:
    method: post
    url: /group/10779/upload
    headers:
      User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like
        Gecko
    params:
    data:
    json:
    result_text: result_text
- action: StrAction
  method: re_match_str
  desc: 字符串正则匹配：文件夹信息
  params:
    str_value: ${result_text}
    pattern: '&_20_struts_action=%2Fdocument_library%2Fview&_20_folderId=(.*?)">(.*?)</a>'
    result: file_data
- action: ListAction
  method: get_list_value
  desc: 获取列表中值
  params:
    list_value: ${file_data}
    list_index: '0'
    result: id_tup
- action: ListAction
  method: get_list_value
  desc: 获取列表中值
  params:
    list_value: ${id_tup}
    list_index: '0'
    result: id
- action: StrAction
  method: str_join
  desc: 字符串拼接
  params:
    str_var1: /group/10779/upload?p_p_id=20&p_p_lifecycle=0&p_p_state=normal&p_p_mode=view&p_p_col_id=column-1&p_p_col_count=1&_20_struts_action=%2Fdocument_library%2Fview&_20_folderId=
    str_var2: ${id}
    result: _20_redirect
- action: HttpAction
  method: request
  desc: 发送POST请求,查询文档
  params:
    method: post
    url: /group/10779/upload
    headers:
      User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like
        Gecko
    params:
      p_p_id: '20'
      p_p_lifecycle: '0'
      p_p_state: maximized
      p_p_mode: view
      p_p_col_id: column-1
      p_p_col_count: '1'
      _20_struts_action: /document_library/search
      _20_redirect: ${_20_redirect}
      _20_breadcrumbsFolderId: ${id}
      _20_searchFolderId: ${id}
      _20_keywords: 文档重命名
    data:
    json:
    result_text: result_text
- action: StrAction
  method: re_match_str
  desc: 字符串正则匹配下载路径
  params:
    str_value: ${result_text}
    pattern: <a href="(.*?)">自动化文件夹名称</a>
    result: file_path
- action: ListAction
  method: get_list_value
  desc: 获取列表中值
  params:
    list_value: ${file_path}
    list_index: '0'
    result: file_path
- action: HttpAction
  method: request
  desc: 发送GET请求,文档下载
  params:
    method: get
    url: ${file_path}
    headers:
      User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like
        Gecko
    params:
    result_content: result_content
- action: FileAction
  method: get_file_joined_path
  desc: 获取file目录文件路径
  params:
    file_name: download_file.txt
    result: download_path
- action: FileAction
  method: write_file_content
  desc: 写入文件内容
  params:
    file_path: ${download_path}
    mode: wb
    content: ${result_content}
